---
title: "Dimorphisme sexuel chez les serpents de mer"
author: "Léa Brohez, Amélie Pierson, Théa Rousseau, Pierre Martin"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
bibliography: references.bib
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but (que vous remanierez éventuellement en fonction des modèles que vous ajouterez plus tard). Vous pouvez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

La transition évolutive de la vie terrestre à la vie aquatique à transformé la morphologie et l'écologie de beaucoup d'espèces de serpents marins. Notamment chez les serpents hydrophiines élapidés et plus précisément les serpents aïpysurine des genres *Emydocephalus* et *Aipysurus*, chez qui l'adaptation à la vie marine aurait pu modifier la sélection naturelle et sexuelle. Ces différents changements s'expriment par un dimorphisme sexuel, c'est à dire par des différences morphologiques entre les individus mâles et femelles.

L'étude de ce dimorphisme nous permettrait de comprendre les contraintes écologiques et comportementales qui feraient évoluer les espèces marines. En particulier, leur morphologie corporelle qui peut nous montrer l'impact des différentes sélections liées à la vie marine.

Le but de cette analyse est de quantifier et modéliser le dimorphisme sexuel chez plusieurs espèces de serpents marins des genres *Emydocephalus* et *Aipysurus* et de déterminer l'influence des sélections sur ces serpents à partir des données mesurées sur différents individus.

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets du premier module de SDD II. -->

Les données ont été collectées par Shine Richard et al. en 2003 et sont disponibles publiquement sur le site [Dryad](https://datadryad.org/dataset/doi:10.5061/dryad.t1g1jwt82). Les informations publiées contiennent un résumé des observations et une explication de comment elles pourraient être utilisées, ainsi qu'un tableau Excel regroupant toutes les données.

Les données ont été modifiées dans le fichier import.R afin de correspondre au mieux à notre travail.

L'analyse de nos données se fait à l'aide du logiciel R (R version4.4.1) dans la [SciviewsBox 2025](https://www.sciviews.org/svbox/) du [Saturn Cloud](https://saturncloud.io) du cours de Science des données de l'UMONS.

```{r setup, include=FALSE}
# Ceci est nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))

# Configure Knitr to use AGG as graphic device
knitr::opts_chunk$set(dev = "ragg_png")

# Configuration de l'environnement
SciViews::R("model", lang = "fr")
```

<!--% Importez les données que vous aurez préalablement nettoyées, remaniées et labélisées dans le script R nommé `R/import.R`. -->

```{r import}
# Lecture des données
sea_snake1 <- read$rds("data/sea_snake1.rds")
# Tableau des premières et dernières lignes
tabularise$headtail(sea_snake1)
```

### Description des données

<!--% Chaque étudiant réalise et interprète un graphique pertinent en lien avec le but fixé et les modèles qui seront réalisés. Graphique et interprétation de l'étudiant #1 ci-dessous. -->

```{r chart1}
chart(data=sea_snake1, tail_length~tail_width_max %col=% sex |species  )+
  geom_point(alpha=0.5)
```

Ce graphique montre la relation entre la longueur et la largeur de la queue pour les six espèces de serpents marins étudiées, permettant ainsi d'évaluer le dimorphisme sexuel lié à ces variables pour chacune des espèces.

Pour l'ensemble des six espèces on observe une corrélation positive entre la longueur et la largeur de la queue : plus la celle-ci est longue, plus elle est large. Cependant, on observe aussi que les nuages de points varient d'une espèce à l'autre, montrant ainsi une différence dans les dimensions de la queue en fonction des espèces. Par exemple, on voit bien que *eydouxii* et *laevis* présentent des valeurs plus élevées pour ces deux variables (queue plus grande) que *annulatus* et *foliosquama*.

En ce qui concerne les différences entre sexes, le graphique montre que les distributions de longueur et de largeur de queue sont très similaires (les points se chevauchent), mais l'ampleur de ce dimorphisme sexuel varie d'une espèce à l'autre.

Pour *laevis* et *duboisii*, ce sont généralement les mâles qui présentent les valeurs les plus élevées pour l'une ou les deux variables. A l'inverse, pour *eydouxii* ce sont les femelles qui atteignent les plus grandes dimensions de queue. Ces différences montrent un dimorphisme sexuel dont l'orientation varie. De plus, pour ces espèces ainsi que *annulatus*, à largeur équivalente, les mâles possèdent une queue plus longue que les femelles.

Pour *foliosquama* et *fuscus*, les nuages de points des différents sexes sont presque entièrement superposés sans séparation marquée. Ceci implique que, dans ces espèces, la morphologie des mâles et des femelles est relativement similaire, et il n'y a donc pas ou peu de dimorphisme observable pour ces deux variables.

<!--% Graphique et interprétation de l'étudiant #2 ci-dessous. -->

```{r chart2}
#chart(data = sea_snake1, body_width ~ svl %col=% sex %shape=% genus | species ) +
#geom_point()
chart(data = sea_snake1, body_width ~ svl %col=% species %shape=% sex | genus ) +
  geom_point(alpha = 0.5)
#chart(data = sea_snake1, ~ body_width %fill=% species %shape=% sex | genus) + 
#geom_bar()
```

Il existe une relation positive entre la longueur museau–cloaque et la largeur du corps. En effet, les individus les plus longs sont également les plus larges.

Le genre *Aipysurus* est beaucoup plus abondant que le genre *Emydocephalus* dans le jeu de données. Celui-ci n’étant représenté que par une seule espèce, avec une variabilité morphologique plus faible.

Le genre *Aipysurus* présente une plus grande diversité morphologique, avec une large gamme de tailles corporelles.

L’espèce *Aipysurus laevis* se distingue par une largeur corporelle significativement plus élevée que celle des autres espèce présentant un fort chevauchement des dimensions corporelles, rendant leur distinction morphologique moins marquée.

La répartition des mâles et des femelles est globalement équilibrée.

Aucun dimorphisme sexuel net n’est observable pour la longueur ou la largeur du corps.

<!--% Graphique et interprétation de l'étudiant #3 ci-dessous. -->

```{r chart3}
chart(data = sea_snake1, head_length ~ head_width %col=% sex | species) +
  geom_point(alpha= 0.5) 
```

-   La répartition des données pour chaque espèces est linéaire.

-   La pente est relativement similaire entre chaque espèces mais on pourrait décrire un léger décalage entre les mâles et les femelles chez l'espèce "*eydouxii*" et "*laevis*".

-   On observe que plus la tête est large, plus elle est longue.

<!--% Graphique et interprétation de l'étudiant #4 ci-dessous. -->

```{r chart4}
#Pierre Martin
sea_snake1$nom_scientifique <- factor(paste(sea_snake1$genus, sea_snake1$species))
sea_snake1$sexe_et_age <- factor(paste(sea_snake1$sex, sea_snake1$adult))

chart(data = sea_snake1, eye_diam ~ adult %fill=% sexe_et_age | nom_scientifique) +
  geom_boxplot() +
   xlab("Age")

 #chart(data = sea_snake1, eye_diam ~ sexe_et_age %fill=% sexe_et_age | nom_scientifique) +
#  geom_boxplot()

# chart(data = sea_snake1, eye_diam ~ adult %fill=% nom_scientifique | sex) +
#  geom_boxplot()

# chart(data = sea_snake1, eye_diam ~ head_width %col=% nom_scientifique %shape=% sexe_et_age) +
#  geom_point(alpha = 0.50)

# chart(data = sea_snake1, eye_diam ~ head_width %col=% sexe_et_age | nom_scientifique) +
#  geom_point(alpha = 0.50)

# Les autres graphiques ont été gardés pour montrer les différents essais.
# Une boîte à moustache a été gardée pour ne pas avoir que des nuages de points.
```

Chez *Aipysurus* *duboisii*, les individus ont un diamètre des yeux médians similaire indépendamment de l'âge et du sexe. Un individu femelle adulte à son diamètre des yeux supérieur à la médiane plus d'1.5 fois supérieur à l'écart interquartile.

Chez *Aipysurus* *eydouxii*, les mâles ont des yeux plus grands que les femelles dans leur catégorie d'âge. Les diamètres médians des yeux sont plus élevés chez les adultes que chez les jeunes.

Chez *Aipysurus* f*ollosquama*, les femelles adultes ont des yeux plus grands que les mâles adultes sans prendre en compte les valeurs en dehors de l'écart interquartile. C'est l'opposé chez les jeunes où les mâles ont des yeux plus gros que les femelles.

Chez *Aipysurus fuscus*, les adultes ont une valeur médiane similaire pour le diamètre des yeux. Mais les mâles ont une plus grande variation de taille supérieure à la médiane.

Chez *Aipysurus* *laevis*, les femelles ont des yeux plus grands que les mâles dans leur catégorie d'âge.

Chez *Emydocephalus* *annulatus*, les adultes ont un diamètre des yeux médian similaire tandis que chez les jeunes, les mâles ont des yeux plus grands que les femelles.

### Modélisation

<!--% Chaque modèle doit être décrit à l'aide d'un graphique et d'un tableau résumant le modèle. Les équations paramétrées de tous les modèles doivent être également présentes. L'analyse des résidus sera réalisée et interprétée pour chaque modèle. -->

#### Régression linéaire 1

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

```{r lms1Lea-Amelie}
snake_lm1 <- lm(data = sea_snake1, tail_length ~ body_width)
summary(snake_lm1) |> tabularise()
```

-   Le modèle de régression linéaire est hautement significatif (Statistique F = 836.7, p\<2.22e-16). Ceci indique que la relation entre ces deux variables n'est pas due au hasard.

-   La largeur du corps est un excellent prédicteur de la longueur de la queue. Le coefficient de détermination multiple (R\^2 = 0.6945) est élevé. Cela signifie que la largeur du corps explique à 69.45% la variance de la longueur de la queue et donc que le modèle explique une grande partie de la variabilité.

-   L'effet est positif , fort et hautement significatif

-   L'ordonnée à l'origine (alpha = 46.56) est significative au seuil alpha de 5%

-   La pente ( beta = 2.11) est positive et est significative au seuil alpha de 5%. Cela signifie que pour chaque augmentation d'une unité de la largeur du corps, la longueur de la queue augmente en moyenne de 2.11 unités

-   La pente étant significative au seuil alpha de 5%, ça valide le fait que comparer la longueur de la queue avec la largeur du corps entre elles est pertinent

-   Le modèle permet prédire efficacement la longueur de la queue à partir de la largeur du corps

```{r lmx1Lea-Amelie}
chart(snake_lm1)
```

-   on observe une corrélation positive entre nos variables (plus la largeur du corps augmente, plus la longueur de la queue augmente aussi)

-   L'intervalle de confiance autour de la droite de régression est relativement étroite, surtout au milieu de celle-ci et ça nous indique que l'estimation de la relation est précise et fiable.

-   On observe une faible dispersion des points autour de la droite de régression ce qui signifie que la régression linéaire est robuste.

-   Le nuage de point est linéaire et se décondense légèrement au niveau des valeurs extrêmes

```{r lmp1Lea-Amelie}
chart$residuals(snake_lm1)
```

-   Les résidus sont faibles par rapport à la plage des valeurs prédites. ( Graphique A)

-   La linéarité est relativement respectée car le nuage de point est légèrement curvilinéaire. (Graphique A)

-   On observe plusieurs valeurs extrêmes. (Graphique A)

-   Les résidus suivent une distribution normale. (Graphique B)

-   Il y a une relativement bonne homoscédasticité des résidus. (Graphique C)

-   Plusieurs points ont une distance de Cook et un effet de levier important. (Graphique D)

#### Régression linéaire 2

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

```{r}
snake_lm2 <- lm(data = sea_snake1, eye_diam ~ head_length)
tabularise(summary(snake_lm2))
```

-   Le modèle est significativement différent au seuil alpha de 5%.

-   Le coefficient de détermination est moyennement élevé (R\^2 ajusté = 0.7811).

-   Tous les termes du modèle sont significatifs au seuil alpha de 5%.

-   L'écart type des résidus est relativement faible ce qui indique une bonne précision de prédiction du modèle.

```{r}
chart(snake_lm2)
```

-   L'enveloppe de confiance autour de la droite de régression est étroite et démontre la précision du modèle.

```{r}
chart$residuals(snake_lm2)
```

-   L'étendue des résidus par rapport aux valeurs prédites est faible.(Graphique A)

-   La distribution des résidus suit une distribution normale.(Graphique B)

-   Il y a homoscédasticité des résidus.(Graphique C)

-   On observe qu'un point présente une distance de Cook et un effet de levier important. (Graphique D)

#### Modèle linéaire 1

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

```{r model1Lea-Amelie}
snake1_lm <- lm(data = sea_snake1, tail_width_max~body_width)
summary(snake1_lm) |> tabularise()
```

-   Le modèle linéaire est hautement significatif (Statistique F = 1394, p\<2.22e-16) et cela indique que la relation entre la largeur de la queue et la largeur du corps n'est pas due au hasard.

-   La largeur du corps est un excellent prédicteur de la largeur de la queue car le coefficient de détermination multiple (R\^2 = 0.7912) est élevé. ça signifie que la largeur du corps explique à 79.12% la variance de la largeur de la queue et donc que le modèle explique une grande partie de la variabilité.

-   L'effet est positif, fort et hautement significatif

-   L'ordonnée à l'origine (alpha = 6.905) est significative au seuil alpha de 5%

-   La pente (beta = 0.637) est positive et est significative au seuil alpha de 5%. Cela signifie que pour chaque augmentation d'une unité de la largeur du corps, la largeur de la queue augmente en moyenne de 0.637 unité.

-   La pente étant significative au seuil alpha de 5%, ça valide le fait que comparer la largeur de la queue avec la largeur du corps entre elles est pertinent.

-   Le modèle permet de prédire efficacement la largeur de la queue à partir de la largeur du corps.

```{r grapmodel1Lea-Amelie}
chart(snake1_lm)
```

-   On observe une corrélation positive entre nos variables (plus la largeur du corps est grande, plus la largeur de la queue est grande aussi).

-   L'intervalle de confiance est étroite sur toute la droite de régression et ça nous indique que l'estimation de la relation est précise.

-   Le nuage de point est linéaire et se décondense légèrement au niveau des valeurs extrêmes.

-   Le modèle est très robuste pour les prédictions car on observe une faible dispersion des points autour de la droite de régression.

```{r residuals1Lea-Amelie}
chart$residuals(snake1_lm)
```

-   Les résidus sont faibles par rapport à la plage des valeurs prédites. (Graphique A)

-   Le nuage de point étant légèrement curvilinéaire, la linéarité est donc relativement respectée. (Graphique A)

-   Plusieurs valeurs extrêmes sont observables. (Graphique A)

-   Les résidus ont une distribution qui ne diffère pas trop de la normale mais semble symétrique. (Graphique B)

-   Il y a une relativement bonne homoscédasticité des résidus. (Graphique C)

-   Plusieurs points ont un effet de levier et une distance de Cook important. (Graphique D)

#### Modèle linéaire 2

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

```{r model2Thea-Pierre}
snake2_lm <- lm(data = sea_snake1, eye_diam ~ (head_length + head_width) * sex)
summary_(snake2_lm)|>tabularise()

#proposition
#snake2_lm2 <- lm(data = sea_snake1, eye_diam ~ (head_length * head_width) * sex +0)
#summary_(snake2_lm2)|>tabularise()
# ce second modèle n'a pas été choisi mais est gardé dans le code comme preuve de recherche de modèle
```

Les pramètres alpha, beta 1 et beta 2 sont tous les trois significatif au seuil alpha de 5%

La valeur du R carré ajusté est 0.8 cela signifie que ce modèle est excellent.

F = 296,9 et p \< 2,2 × 10⁻¹⁶ Le modèle est très fortement significatif dans son ensemble.

```{r graphmodel2Thea-Pierre}
#chart(snake2_lm) #on peut pas faire en 2D

#Si tu veux mettre un graphique en 3D c'est le code. Les femelles sont en bleu et les mâles en rose.
car::scatter3d(data = sea_snake1, eye_diam ~ (head_length + head_width) * sex,
  fit = "linear", residuals = TRUE, bg.col = "white", axis.scales = TRUE,
  grid = TRUE, ellipsoid = FALSE)
rgl::rglwidget(width = 800, height = 800)
```

Les deux nuages de points se superposent et sont linéaires.

Le plan des femelles est plus élevé que celui des mâles car, en moyenne, elles ont un diamètre des yeux plus grand.

```{r residuals2Thea-Pierre}
chart$residuals(snake2_lm)
```

Les résidus sont moyens par rapport à la plage de valeurs prédites (A)

La linéarité est relativement bien respectée (A)

Les résidus ont une distribution qui ne diffère pas trop de la Normale, et elle est symétrique (B)

ll y a une relativement bonne homoscédasticité des résidus (C).

Un point a un effet de levier important, mais sans influencer le modèle car sa distance de Cook est faible (D)

#### Modèle linéaire généralisé et/ou mixte 1

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r}
#GLM(M)1Lea-Amelie

# 1. Préparer la variable sexe (0 = femelle, 1 = mâle)
sea_snake1$sex_bin <- ifelse(sea_snake1$sex == "m", 1, 0)

snake_glm1 <- glm(data = sea_snake1, log(body_width) ~ log(svl) + sex_bin, family = gaussian)
summary(snake_glm1) |>tabularise()
```

-   La longueur museau-cloaque (SVL) et le sexe prédisent la largeur du corps. Il existe une relation positive entre les données SVL et body_width.

-   Le sexe a un effet significatif sur la largeur du corps (p\<0.001). Le coefficient négatif de sex_bin (-0.0834) indique que les mâles sont significativement moins larges que les femelles pour une même longueur museau-cloaque.

-   Nous avons un cas de sousdispersion dûe à la déviance résiduelle qui est beaucoup plus petite que la valeur des degrés de liberté.

```{r}
# chartGLM(M)1Lea-Amelie

# On ajoute les prédictions du modèle dans le tableau
sea_snake1$prediction <- predict(snake_glm1)

# créer le graphique 
ggplot(sea_snake1, aes(x = log(svl), y = log(body_width), color = as.factor(sex))) +
  # Affiche les observations
  geom_point(alpha = 0.6) + 
  # Affiche les droites du modèle 
  geom_line(aes(y = prediction), size = 1) + 
  # Titres et légendes
  labs(
    title = "Modèle GLM : Largeur du corps vs Longueur (SVL)",
    subtitle = "Échelle Log-Log - Lignes parallèles imposées par le modèle sans interaction",
    x = "Logarithme de la longueur museau-cloaque",
    y = "Logarithme de la largeur du corps",
    color = "Sexe"
  )

```

-   On observe une relation positive entre la longueur museau-cloaque (SVL) et la largeur du corps. Quand la SVL augmente, la largeur du corps augmente aussi. Sur une échelle log–log, cela indique une croissance proportionnelle.

-   Chez les deux sexes, la longueur museau-cloaque (SVL) est un bon prédicteur de la largeur du corps (body_width).

-   À taille égale, les femelles ont en moyenne, un corps plus large que les mâles.

-   Les points sont relativement proches des lignes. De ce fait, nous pouvons dire que les résidus sont plutôt faibles.

```{r}
# residualsGLM(M)1Lea-Amelie
chart$residuals(snake_glm1)
```

-   Les résidus sont faibles par rapport à la plage des valeurs prédites (Graphique A)

-   La linéarité est relativement respectée. (Graphique A)

-   Les résidus ont une distribution qui ne diffèrent pas trop de la normale (Graphique B)

-   Il y a une relativement bonne homoscédasticité (Graphique C)

-   Plusieurs points ont un effet de levier important mais sans influencer le modèle car la distance de Cook est faible. (Graphique D)

#### Modèle linéaire généralisé et/ou mixte 2

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r}
# GLM(M)2Thea-Pierre
snake_glm2 <- glm( data = sea_snake1, sex_bin ~ eye_diam, family = binomial)
summary_(snake_glm2) |> tabularise()# transfo adult en facteur
```

La dispersion vaut 1.38 (506.7/368) alors que le paramètre de dispersion du modèle est fixé à 1. Nous sommes dans un cas de légère surdispersion.

Les deux paramètres sont significativement différents de 0 au seuil alpha de 5%.

```{r}
#chartGLM2Théa-Pierre 
#transfo y en 0-1

#graphique
chart(data = sea_snake1, sex_bin ~ eye_diam) +
  geom_point() +
  stat_smooth(method = "glm",method.args = list(family = binomial), formula = y ~ x)
```

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les modèles les plus pertinents que vous retenez ? -->

```{r}
AIC(snake_lm1, snake_lm2, snake1_lm, snake2_lm, snake_glm1, snake_glm2)

```

Dans la recherche des 2 meilleurs modèles, le modèle snake_lm1 et le snake1_lm sont rejetés car leur AIC est beaucoup plus élevé que les autres.

Le modèle snake2_lm est préféré au modèle snake_lm2 car sont AIC est plus faible et que son R carré ajusté est légèrement supérieur (R2 ajusté : 0.8004 \> R2 ajusté : 0.7811)

Le modèle de glm choisit pour le rapport est snake_glm1 car son AIC est négatif et est beaucoup plus bas que celui du snake_glm2.

Le modèle snake_glm1 est aussi choisi car il suit une gaussienne tandis que snake_glm2 suit une binomiale que nous n'avons pas appris à analyser en cours.

## Références

<!--% N'indiquez rien ci-dessous. Quarto se chargera de rajouter vos références bibliographiques automatiquement. -->
